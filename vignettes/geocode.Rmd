---
title: "nl_geocode"
author: "Edwin de Jonge, Willy Tadema"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{nl_geocode with mapview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(mapview)
library(sf)
library(nlgeocoder)
```

**nl_geocode** is intended to provide a quick and easy way to geocode labels of locations in The Netherlands. It will only returns points or centroids, no polylines or polygons.

## Geocode addresses

By default, **nl_geocode** will search for addresses.    

```{r}
library(nlgeocoder)

res <- nl_geocode("Martinikerkhof 3 Groningen") 
res$weergavenaam
```

You can also search for multiple addresses at once.

```{r}
locations <- c("Martinikerkhof 3", "Sint Jansstraat 4 Groningen", "9726AE 4", "9711 ME 1")
res <- nl_geocode(locations)
res$weergavenaam
```

As you can see, the address doesn't need to be an exact match. Uppercases are ignored.

## Search for different type of locations

Besides addresses, you can also search for places, municipalities, provinces, roads and many more. See the [LocatieServer API documentation](https://github.com/PDOK/locatieserver/wiki/API-Locatieserver) complete list of types you can choose from.

You can restrict the output of `geocode` to municipalities only:

```{r}
res <- nl_geocode("Groningen", type = "gemeente") 
res$weergavenaam
res$type
```

You can also restrict the output to places:

```{r}
res <- nl_geocode("Groningen", type = "woonplaats") 
res$weergavenaam
res$type
```

If you are only interested in results in a particular area (for instance a province or municipality) you can use the `fq` parameter.

```{r}
res <- nl_geocode("Hoofdstraat", fq = "provincienaam:Groningen") 
res$weergavenaam
res$provincienaam
```

## Return coordinates in a spatial dataframe with CRS WGS84 or RD_New

By default, **nl_geocode** will return an `sf` object with coordinates in the coordinate reference system WGS84 (EPSG:4368). 

```{r}
res <- nl_geocode("Martinikerkhof 3 Groningen") 
class(res)
st_crs(res)["epsg"]
```

It also possible to specify that the coordinates should be in RD_New (EPSG:28992), the Dutch coordinate reference system.

```{r}
res <- nl_geocode("Martinikerkhof 3 Groningen", output = "rd") 
class(res)
st_crs(res)["epsg"]
```

You can also use the `nl_geocode_rd` function instead:
```{r}
res <- nl_geocode_rd("Martinikerkhof 3 Groningen") 
class(res)
st_crs(res)["epsg"]
```

## Return coordinates in a dataframe

You can use the parameter `output` to indicate that you only want the labels, and not the geometry.

```{r}
res <- nl_geocode("Martinikerkhof 3 Groningen", output = "data.frame") 
class(res)
```

## Plot the output on a map

Plotting the output on a map, because by default **nl_geocode** returns an `sf` object.

```{r}
poi<- data.frame(label = c("Martinitoren", "Provinciehuis", "Groninger Museum", "Centraal Station", "Groninger Forum"), 
                  location = c("Martinikerkhof 3 Groningen", "Sint Jansstraat 4 Groningen", "9711 ME 1", "9726 AE 4", "Hereplein 73 Groningen"))   
poi_geocoded <- nl_geocode(poi$location)
mapview(poi_geocoded)
```
